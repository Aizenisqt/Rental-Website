@page 
@model IndexModel
@{
    ViewData["Title"] = "Home page";
    
}
<link rel="stylesheet" href="~/css/UserProfile.css" />



<div class="modal fade" id="ItemInfo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content " id="custom-modal-bg">
            <div class="modal-header">
                @* <h1 class="modal-title fs-3" id="itemTitle"></h1> *@
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h1 class="modal-title fs-3" id="itemTitle"></h1>
                <!-- Bootstrap carousel -->
                <div id="carouselExample" class="carousel slide">
                    <div class="carousel-inner" id="itemPhotos"></div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <div class="ItemInfoContainer">
                    <div class="itemDescription">
                        <img src="~/icon/ForRent.png" style="position: absolute;top: 84%;left: 4%;width: 150px;height: auto;" />
                        <hr style="margin:0;border-width:1px;" />
                        <h4 class="fs-5" style=" position: absolute;top: 95%;left: 20%;width: 110px;height: auto;">
                            <strong>Price:</strong> $<span id="itemPrice"></span>
                        </h4>
                        <p class="fs-5" id="itemDescription"></p>

                    </div>


                    <div class="Price_Inclusion" style="text-align:center;">
                        <h4 id="InclusionHeader" style=" background-color: #D7BBF5;padding:10px;text-align:center;margin:3px;border-radius:10px;">
                            Inclusion
                        </h4>
                        <p class="fs-5" id="itemInclusion"></p>
                    </div>
                </div>
               <div class="d-flex">
                    <button type="button" class="m-3 w-100 btn btn-outline-success">Message</button>

                    <a class="m-3 w-100 btn btn-outline-info" id="VisitBtn" href="#">Visit</a>                       
                  
               </div>
            </div>

            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

<div id="search-section" style="padding-top:90px; padding-left:15px;">
    <form class="flex-grow-1">
        <input class="form-control"
               id="searchInput"
               type="search"
               placeholder="Search Something"
               aria-label="Search"
               style="width:96%;">
    </form>

    <div class="Itemcontainer">
       

        @foreach (var item in Model.Items)
        {
            <ul id="myList">
                <li><a id="itemLink" href="OtherUserProfile?id=@item.Id">@item.Title</a></li>

            </ul>
        }
    </div>


</div>


    <div class="gallery">

    @foreach (var photo in Model.Items)
    {
        var firstPhoto = photo.ItemPhotos.FirstOrDefault();
        <div class="ItemList">

            <button type="button" data-bs-toggle="modal" data-bs-target="#ItemInfo" style="border:none; padding:0;"
                    data-title="@photo.Title"
                    data-description="@photo.ItemDescription"
                    data-inclusion="@photo.Inclusion"
                    data-price="@photo.price"
                    data-id="@photo.UserId"
                    data-photos="@string.Join(",", photo.ItemPhotos)">
                <div class="photoItem">
                    <img src="@Url.Content("/" + firstPhoto)" alt="Item Photo" style="margin:0;"/>
                </div>
            </button>
        
        </div>

    }
    </div>


<script>
   const searchInput = document.getElementById("searchInput");
   const listItems = document.querySelectorAll("#myList li");

       

    // Hide all items when page loads
    listItems.forEach(item => {
      item.style.display = "none";
    });

    searchInput.addEventListener("keyup", function() {
      let filter = searchInput.value.toLowerCase();

      listItems.forEach(item => {
        let text = item.textContent.toLowerCase();

        if (filter === "") {
          item.style.display = "none"; // hide all if input is empty
        } else if (text.includes(filter)) {
          item.style.display = "";
        } else {
          item.style.display = "none";
        }
      });
    });


          //  const listItems = document.querySelectorAll("#myList li");
          //    const userid = listItems.getAttribute("data-id");
          // const itemLink = document.getElementById("#itemLink");
          //    itemLink.href =  "OtherUserProfile?id=" + userid;



    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("ItemInfo");
        

        modal.addEventListener("show.bs.modal", event => {
            const button = event.relatedTarget;

            // Read item info from button
            const title = button.getAttribute("data-title");
            const description = button.getAttribute("data-description");
            const inclusion = button.getAttribute("data-inclusion");
            const price = button.getAttribute("data-price");
            const photos = button.getAttribute("data-photos").split(",");
            const userid = button.getAttribute("data-id");
            // Fill modal text
            modal.querySelector("#itemTitle").textContent = title;
            modal.querySelector("#itemDescription").textContent = description;
            modal.querySelector("#itemInclusion").textContent = inclusion;
            modal.querySelector("#itemPrice").textContent = price;

            const visitBtn = modal.querySelector("#VisitBtn");
            visitBtn.href = "OtherUserProfile?id=" + userid;


            // Fill carousel with photos
            const photoContainer = modal.querySelector("#itemPhotos");
            photoContainer.innerHTML = ""; // reset

            photos.forEach((p, i) => {
                const div = document.createElement("div");
                div.classList.add("carousel-item");
                if (i === 0) div.classList.add("active"); // first photo active

                const img = document.createElement("img");
                img.src = "/" + p.trim();
                img.classList.add("d-block", "w-100");

                div.appendChild(img);
                photoContainer.appendChild(div);
            });
        });




      
    });

</script>


